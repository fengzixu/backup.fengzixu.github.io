<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Reflection in golang (3) | LittleDriver</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="http://littledriver.net/css/theme-override.css">
    <header>

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <nav>
    <ul>
      
      
      <li class="pull-left ">
        <a href="http://littledriver.net/">/home/littledriver</a>
      </li>
      
      
      <li class="pull-left ">
        <a href="/">~/home</a>
      </li>
      
      
      <li class="pull-left ">
        <a href="/categories/">~/categories</a>
      </li>
      
      
      <li class="pull-left ">
        <a href="/tags/">~/tags</a>
      </li>
      

      
      
      <li class="pull-right">
        <a href="/index.xml">~/subscribe</a>
      </li>
      

    </ul>
  </nav>
</header>

  </head>

  <body>
    <br/>

<div class="article-meta">
<h1><span class="title">Reflection in golang (3)</span></h1>

<h2 class="date">2017/03/11</h2>
<p class="terms">
  
  
  Categories: <a href="/categories/%E5%B7%A5%E4%BD%9C%E4%BA%86%E4%B9%9F%E4%B8%8D%E8%83%BD%E6%94%BE%E6%9D%BE%E7%B3%BB%E5%88%97">å·¥ä½œäº†ä¹Ÿä¸èƒ½æ”¾æ¾ç³»åˆ—</a> 
  
  
  
  Tags: <a href="/tags/golang">Golang</a> 
  
  
</p>
</div>



<main>
<p></p>

<h1 id="å‰æ™¯æè¦">å‰æ™¯æè¦</h1>

<p>ä¸Šä¸€ç¯‡æ–‡ç« å½“ä¸­ï¼Œä¸»è¦ä»¥å®ç°äº†ä¸€ä¸ªdisplayå‡½æ•°ä¸ºä¸»è¦å†…å®¹ï¼Œé˜è¿°äº†å¦‚ä½•é€šè¿‡golangçš„reflectåŒ…å°†ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹çš„æ•°æ®æ ¼å¼åŒ–è¾“å‡ºï¼Œå®ƒç±»ä¼¼äºä¸€ä¸ªç®€æ´ç‰ˆçš„fmt.Printfå‡½æ•°ã€‚ä½†æ˜¯è¿™ä¸ªå‡½æ•°åªæ˜¯ç®€å•çš„å®ç°äº†ä»å…·ä½“ç±»å‹çš„æ•°æ®åˆ°å­—ç¬¦ä¸²çš„è¾“å‡ºåŠŸèƒ½ã€‚åœ¨æ—¥å¸¸çš„å·¥ä½œä¸­ï¼Œæˆ‘ä»¬æ—¶å¸¸è¦é€šè¿‡http/httpsè¯·æ±‚è°ƒç”¨ä¸€äº›ç¬¬ä¸‰æ–¹æœåŠ¡çš„æ¥å£ï¼Œä¼ è¾“çš„æ•°æ®ä¸ä½†éœ€è¦ä¿æŒä¸€å®šçš„ç¼–ç æ ¼å¼ï¼Œè¿˜éœ€è¦æŒ‰ç…§è¢«è°ƒç”¨æœåŠ¡æ¥å£æ¥æ”¶æ•°æ®çš„è§„èŒƒæ¥æ„é€ æˆ‘ä»¬çš„è¯·æ±‚æ•°æ®ã€‚</p>

<p>åœ¨ä½¿ç”¨golangçš„è¿‡ç¨‹å½“ä¸­ï¼Œä¸€å®šå°‘ä¸äº†å¯¹encoding/jsonåŒ…å½“ä¸­çš„json.Marshalæ–¹æ³•çš„ä½¿ç”¨ï¼Œä»–æ¥æ”¶ä¸€ä¸ªinterfaceå€¼, è¿”å›ä¸€ä¸ªä»¥ASN.1æ ¼å¼ç¼–ç byteæ•°ç»„ã€‚ ASN.1æ˜¯ä¸€å¥—æ­£å¼ä¸”å…¬ç”¨çš„ç¼–ç æ ‡å‡†ï¼Œä½¿ç”¨json.Marshalå¯¹æˆ‘ä»¬çš„æ•°æ®è¿›è¡Œç¼–ç ä¹‹åï¼Œå¾—åˆ°çš„ç»“æœå°±å¯ä»¥åœ¨è¿›ç¨‹é—´ä»¥åŠæœåŠ¡é—´è¿›è¡Œä¼ è¾“ã€‚ç¼–ç è¿™ä»¶äº‹ï¼Œè¯´ç™½äº†ï¼Œå°±æ˜¯æŠŠæˆ‘ä»¬å‡†å¤‡å¥½çš„æ•°æ®é€šè¿‡ä¸€å®šçš„è§„åˆ™è½¬æ¢æˆå¦å¤–ä¸€ç§è¡¨ç°å½¢å¼ï¼Œæ¯”å¦‚æŠŠåè¿›åˆ¶æ•°å­—è½¬æ¢æˆäºŒè¿›åˆ¶æ•°æ®ï¼Œæˆ‘è§‰å¾—è¿™å°±æ˜¯ä¸€ç§ç¼–ç ã€‚å†ä¸ç†è§£çš„è¯ï¼Œä¹Ÿå¯ä»¥æƒ³æƒ³è«æ–¯å¯†ç”µç ï¼Œåº”è¯¥å¾ˆå®¹æ˜“å°±æ˜ç™½äº†ã€‚</p>

<p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œå°†ä¼šå¯¹ä¸Šæ¬¡æˆ‘ä»¬å®ç°çš„displayå‡½æ•°è¿›è¡Œå†ä¸€æ¬¡çš„æ‰©å±•ï¼Œä½¿å…¶èƒ½å¤Ÿå…·å¤‡æ•°æ®ç¼–ç çš„åŠŸèƒ½.</p>

<h1 id="encoding">Encoding</h1>

<p>golangçš„æ ‡å‡†åº“å†…ä¸ºæˆ‘ä»¬æä¾›äº†å‡ ç§å¸¸è§å¹¶ä¸”é€šç”¨çš„ç¼–ç æ ¼å¼ï¼Œå¦‚ï¼Œxml, json, asn.1ç­‰ã€‚ç†Ÿæ‚‰lispæˆ–è€…schemeçš„äººè‚¯å®šçŸ¥é“s-expressionè¿™ç§æ ¼å¼ã€‚ä»¿ç…§ã€ŠThe Go programing languageã€‹ä¸€ä¹¦ä¸­çš„ä¾‹å­ï¼Œæˆ‘è‡ªå·±ä¹Ÿå®ç°äº†ä¸€ä¸ªå°†æ™®é€šæ•°æ®ç¼–ç æˆs-expressionå½¢å¼çš„å‡½æ•°ã€‚ï¼ˆç”±äºæ³¨é‡çš„æ˜¯åå°„çš„ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨ä»£ç é£æ ¼ä¸Šé¢æ²¡æœ‰åšè¿‡å¤šçš„æ³¨æ„ï¼Œå„ä½çœ‹å®˜å‹¿å–·ï¼‰</p>

<p>åœ¨æˆ‘å®ç°çš„Encodingå‡½æ•°ä¸­ï¼Œæˆ‘ä¸»è¦å¤„ç†äº†String, int, array, slice, struct, map, ptrç­‰ç±»å‹çš„æ•°æ®ç¼–ç ï¼Œå…¶ä½™çš„å¦‚interfaceç­‰ç±»å‹ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘å¹¶æ²¡æœ‰å¯¹å…¶åšå¤„ç†ã€‚ç¼–ç çš„è§„èŒƒå¦‚ä¸‹ï¼š</p>

<ol>
<li>æ•°å­—çš„ç±»å‹å¦‚intè¿˜æ˜¯ç›´æ¥ç¼–ç æˆå¯¹åº”çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚å­—ç¬¦ä¸²ç±»å‹ä¹Ÿæ˜¯ä¸€æ ·</li>
<li>structç±»å‹ç¼–ç æˆï¼ˆ(fieldName fieldValue) (fieldName fieldValue) &hellip;ï¼‰çš„å½¢å¼</li>
<li>mapç±»å‹ç¼–ç æˆ ((keyName value), (keyName value) &hellip;)çš„å½¢å¼</li>
<li>æŒ‡é’ˆç±»å‹ä¸åšç‰¹æ®Šå¤„ç†ï¼Œè€Œæ˜¯è·å–åˆ°å…¶æŒ‡å‘çš„å˜é‡ä¹‹åï¼Œå¯¹è¿™ä¸ªå˜é‡ç¼–ç ã€‚</li>
</ol>

<pre><code>
package main

import (
	&quot;bytes&quot;
	&quot;fmt&quot;
	&quot;reflect&quot;
)

func Encode(value reflect.Value, buff *bytes.Buffer) (err error) {
	switch value.Kind() {
	case reflect.Invalid:
		_, err = buff.Write([]byte(&quot;nil&quot;))
	case reflect.Int, reflect.Int8, reflect.Int16, reflect.Int32, reflect.Int64:
		fmt.Fprintf(buff, &quot;%d&quot;, value.Int())
	case reflect.String:
		fmt.Fprintf(buff, &quot;%q&quot;, value.String())
	case reflect.Ptr:
		err = Encode(value.Elem(), buff)
	case reflect.Array, reflect.Slice:
		_, err = buff.WriteString(&quot;(&quot;)
		if err != nil {
			return
		}

		for i := 0; i &lt; value.Len(); i++ {
			err = Encode(value.Index(i), buff)
			if err != nil {
				return
			}

			if i != value.Len()-1 {
				_, err = buff.WriteString(&quot; &quot;)
				if err != nil {
					return
				}
			}
		}

		_, err = buff.WriteString(&quot;)&quot;)
	case reflect.Struct:
		_, err = buff.WriteString(&quot;(&quot;)
		if err != nil {
			return
		}

		for j := 0; j &lt; value.NumField(); j++ {
			if j &gt; 0 {
				_, err = buff.WriteString(&quot; &quot;)
				if err != nil {
					return
				}
			}

			_, err = buff.WriteString(&quot;(&quot;)
			if err != nil {
				return
			}

			_, err = buff.WriteString(value.Type().Field(j).Name)
			if err != nil {
				return
			}

			_, err = buff.WriteString(&quot; &quot;)
			if err != nil {
				return

			}

			err = Encode(value.Field(j), buff)
			if err != nil {
				return
			}

			_, err = buff.WriteString(&quot;)&quot;)
			if err != nil {
				return
			}
		}

		_, err = buff.WriteString(&quot;)&quot;)
		if err != nil {
			return
		}

	case reflect.Map:
		_, err = buff.WriteString(&quot;(&quot;)
		if err != nil {
			return
		}

		for j, k := range value.MapKeys() {
			if j &gt; 0 {
				_, err = buff.WriteString(&quot; &quot;)
				if err != nil {
					return
				}
			}

			_, err = buff.WriteString(&quot;(&quot;)
			if err != nil {
				return
			}

			err = Encode(k, buff)
			if err != nil {
				return
			}

			_, err = buff.WriteString(&quot; &quot;)
			if err != nil {
				return

			}

			err = Encode(value.MapIndex(k), buff)
			if err != nil {
				return
			}

			_, err = buff.WriteString(&quot;)&quot;)
			if err != nil {
				return
			}
		}

		_, err = buff.WriteString(&quot;)&quot;)
		if err != nil {
			return
		}

	default:
		fmt.Fprintf(buff, &quot;%s:%s&quot;, &quot;unsupport type&quot;, value.Kind())
	}

	return
}

type B struct {
	Fuck string `json:&quot;fuck&quot;`
	You  int    `json:&quot;you&quot;`
}

type A struct {
	Domain   string            `json:&quot;domain&quot;`
	Cache    []string          `json:&quot;cache&quot;`
	CdnState map[string]string `json:&quot;cdnState&quot;`
	Time     int               `json:&quot;time&quot;`
	B        `json:,inline`
}

func main() {
	b := B{
		Fuck: &quot;fff&quot;,
		You:  3,
	}

	obj := A{
		Domain: &quot;hahah.com&quot;,
		Cache:  []string{&quot;1&quot;, &quot;2&quot;, &quot;3&quot;},
		CdnState: map[string]string{
			&quot;ws&quot;: &quot;success&quot;,
			&quot;tc&quot;: &quot;success&quot;,
		},
		Time: 2,
		B:    b,
	}

	buff := bytes.Buffer{}
	err := Encode(reflect.ValueOf(obj), &amp;buff)
	if err != nil {
		fmt.Printf(&quot;Error: %+v&quot;, err)
		return
	}

	fmt.Printf(&quot;%+v\n&quot;, string(buff.Bytes()))
	return
}

</code></pre>

<p>ä¸Šè¿°ä»£ç çš„è¾“å‡ºç»“æœä¸º:</p>

<pre><code>ğŸ‘‰  go run encode.go
((Domain &quot;hahah.com&quot;) (Cache (&quot;1&quot; &quot;2&quot; &quot;3&quot;)) (CdnState ((&quot;tc&quot; &quot;success&quot;) (&quot;ws&quot; &quot;success&quot;))) (Time 2) (B ((Fuck &quot;fff&quot;) (You 3))))
    
</code></pre>

<p>å¯ä»¥çœ‹å‡ºï¼ŒEncodingå‡½æ•°å·²ç»ç®€å•çš„å°†æ™®é€šæ•°æ®ç±»å‹çš„æ•°æ®ç¼–ç æˆäº†s-expressionçš„å½¢å¼ã€‚å…¶å®ç¼–ç çš„æ ¼å¼å¹¶ä¸ä¸€å®šè¦å±€é™äºä¸€äº›ç›®å‰å…¬è®¤æ ‡å‡†çš„æ ¼å¼ï¼Œæˆ‘ä»¬ä¹Ÿå®Œå…¨å¯ä»¥å®šä¹‰ä¸€å¥—è‡ªå·±çš„è§„åˆ™ã€‚åªè¦è¿™å¥—è§„åˆ™åœ¨ç¼–ç å’Œè§£ç çš„è¿‡ç¨‹ä¸­éƒ½èƒ½å¤Ÿä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§å³å¯ã€‚</p>

<h1 id="set-value">Set value</h1>

<p>ä¹‹å‰çš„å‡ ç¯‡å…³äºåå°„çš„æ–‡ç« ï¼Œç”šè‡³æ˜¯è¿™ä¸€ç¯‡æ–‡ç« ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œåœ¨ä»£ç ä¸Šé¢çš„å®ç°ä»¥åŠå¯¹åå°„çš„è®²è§£éƒ½åœç•™åœ¨è§‚å¯Ÿçš„å±‚é¢ä¸Šï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä»…ä»…æ˜¯æŠŠä¸€ä¸ªæ™®é€šæ•°æ®ç±»å‹çš„å€¼é€šè¿‡åå°„æ›´è¿›ä¸€æ­¥çš„è·å–ä»–ä»¬ä¿¡æ¯ï¼Œå¦‚ç±»å‹ï¼Œå€¼ç­‰ç­‰ã€‚ç„¶åå¯ä»¥é€šè¿‡ä¸€äº›æ‰‹æ®µæ ¼å¼åŒ–è¾“å‡ºä»–ä»¬ã€‚å®é™…ä¸Šï¼Œä¹‹å‰å‡ ç¯‡æ–‡ç« çš„é‡ç‚¹ï¼Œå¹¶ä¸åœ¨äºä½¿ç”¨reflectåŒ…å®ç°ä¸€äº›å…·ä½“çš„åŠŸèƒ½ï¼Œè€Œæ˜¯åœ¨å‘å¤§å®¶çªå‡ºï¼Œåˆ©ç”¨reflectå‡ ä¹å¯ä»¥å¤„ç†æ‰€æœ‰ç°åœ¨çš„ä»¥åŠæœªæ¥çš„æ•°æ®ç±»å‹ã€‚å½“ä½ æŠŠæ™®é€šçš„æ•°æ®ç±»å‹é€šè¿‡reflect.ValueOfè½¬æ¢æˆreflect.Valueç±»å‹å€¼çš„æ—¶å€™ï¼Œä½ å¯ä»¥ä»¥ä»–ä¸ºèµ·ç‚¹å»åšä»»ä½•äº‹æƒ…ã€‚ä¹‹å‰å®ç°çš„æ ¼å¼åŒ–è¾“å‡ºï¼Œä»¥åŠä¸Šé¢å®ç°çš„ç¼–ç åŠŸèƒ½ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥äº†è§£ä¸€ä¸‹ï¼Œå¦‚ä½•é€šè¿‡refletåŒ…æ¥æ›´æ”¹ä¸€äº›æœªçŸ¥çš„æ•°æ®ç±»å‹çš„å€¼ã€‚</p>

<h2 id="ä»å˜é‡è¯´èµ·">ä»å˜é‡è¯´èµ·</h2>

<p>å¤§å®¶éƒ½çŸ¥é“ï¼Œç¼–ç¨‹ä¸­æœ€å¸¸è§çš„ä¸¤ä¸ªæ¦‚å¿µå°±æ˜¯å˜é‡å’Œå¸¸é‡ã€‚é¡¾åæ€ä¹‰ï¼Œå˜é‡æ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œå¸¸é‡æ˜¯æ’ä¹…ä¸å˜çš„ã€‚å˜é‡ä¸ºä»€ä¹ˆå¯ä»¥æ”¹å˜å‘¢ï¼Ÿå› ä¸ºå˜é‡æœ¬èº«å°±æ˜¯ä¸€ä¸ªè¢«åå­—æ ‡è¯†çš„å†…å­˜ç©ºé—´ï¼Œå®ƒæ˜¯å¯å¯»å€çš„ã€‚åªè¦ä¸€ä¸ªä¸œè¥¿æ˜¯å¯å¯»å€çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åœ°å€åœ¨å†…å­˜ä¸­æ‰¾åˆ°ä»–çš„ä½ç½®ï¼Œç„¶åä¿®æ”¹å®ƒå†…å­˜ç©ºé—´ä¸­æ‰€ä¿å­˜çš„å†…å®¹ã€‚è¿™å…¶å®ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ç»™å˜é‡èµ‹å€¼çš„è¿‡ç¨‹ã€‚</p>

<p>å¯¹äºreflect.Valueå€¼æ¥è¯´ï¼Œå®ƒå’Œinterfaceä¸€æ ·ï¼Œæœ¬èº«å¯ä»¥æ¥å—ä»»ä½•ç±»å‹çš„æ•°æ®ã€‚é‚£ä¹ˆä»»æ„reflect.Valueçš„å€¼éƒ½å¯ä»¥åƒå˜é‡ä¸€æ ·éšæ„çš„æ›´æ”¹ä¹ˆï¼Ÿæˆ‘ä»¬å†™ä¸€ä¸ªdemoè¯•è¯•å°±çŸ¥é“äº†</p>

<pre><code>    a := 2
    x := reflect.ValueOf(a)
    fmt.Println(x.CanSet())  //false

    y := reflect.ValueOf(&amp;a)
    fmt.Println(y.CanSet())  //false

    z := y.Elem()
    fmt.Println(z.CanSet()  //true
</code></pre>

<p>é€šè¿‡è°ƒç”¨reflect.Value.CanSetæ–¹æ³•ï¼Œæ ¹æ®å…¶è¿”å›çš„ç»“æœæ˜¯trueè¿˜æ˜¯falseå°±å¯ä»¥ç¡®å®šä¸€ä¸ªreflect.Valueå€¼æ˜¯ä¸æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚ xåœ¨è°ƒç”¨çš„æ—¶å€™è¿”å›äº†false,è¿™æ˜¯å› ä¸ºåœ¨æ„é€ xçš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯aè¿™ä¸ªå˜é‡å†…å­˜å‚¨çš„å€¼2ï¼Œä½†æ˜¯å®ƒè‡ªå·±å¹¶æ²¡æœ‰ç”³è¯·å†…å­˜æ¥å­˜è¿™ä¸ªå€¼. yä¹ŸåŒæ ·æ˜¯è¿™æ ·ï¼Œè™½ç„¶å®ƒæ˜¯é€šè¿‡aå˜é‡çš„åœ°å€å€¼æ¥æ„é€ çš„ã€‚äº‹å®ä¸Šï¼Œä»»ä½•é€šè¿‡reflect.ValueOfæ„é€ å‡ºæ¥çš„reflect.Valueéƒ½æ˜¯ä¸å¯å¯»å€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªæ˜¯copyäº†ä¸€ä»½å€¼æ¥æ˜¾ç¤ºï¼Œå¹¶ä¸èƒ½å»æ”¹åŠ¨ä»–ã€‚</p>

<p>ä½†æ˜¯å½“æˆ‘ä»¬å¯¹yè°ƒç”¨Elemæ–¹æ³•å¾—åˆ°zï¼Œzå´æ˜¯ä¸€ä¸ªå¯ä»¥æ”¹å˜çš„å€¼ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿé¦–å…ˆyæ˜¯é€šè¿‡ä¸€ä¸ªæŒ‡é’ˆçš„å€¼æ¥æ„é€ çš„ï¼Œå…¶å†…å­˜å­˜å‚¨çš„æ˜¯aè¿™ä¸ªå˜é‡çš„å†…å­˜åœ°å€ã€‚è°ƒç”¨Elem()æ–¹æ³•ï¼Œå¾—åˆ°çš„æ˜¯è¿™ä¸ªåœ°å€æŒ‡å‘çš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯aè¿™ä¸ªå˜é‡çš„åœ°å€ç©ºé—´ã€‚èµ‹å€¼ç»™zä¹Ÿå¹¶æ²¡æœ‰åˆ‡æ–­yæ‰€æŒ‡å‘çš„å†…å­˜ç©ºé—´ä¸açš„è”ç³»ï¼Œä»…ä»…æ˜¯ç»™è¿™å—ç©ºé—´èµ·äº†ä¸€ä¸ªåˆ«åã€‚</p>

<p>reflectåŒ…ä¸­è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å«åšCanAddrã€‚å®ƒçš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p>

<pre><code>CanAddr reports whether the value's address can be obtained with Addr. Such values are called addressable. A value is addressable if it is an element of a slice, an element of an addressable array, a field of an addressable struct, or the result of dereferencing a pointer. If CanAddr returns false, calling Addr will panic
</code></pre>

<p>å®ƒçš„åŠŸèƒ½æ˜¯å¯ä»¥åˆ¤æ–­å‡ºä¸€ä¸ªreflect.Valueæ˜¯å¦æ˜¯å¯å¯»å€çš„ã€‚åœ¨å®ƒçš„æè¿°å½“ä¸­ä¹ŸæŒ‡å‡ºäº†ï¼Œsliceæˆ–è€…ä¸€ä¸ªå¯å¯»å€æ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œæˆ–è€…ä¸€ä¸ªå¯å¯»å€çš„ç»“æ„ä½“çš„ä¸€ä¸ªå±æ€§ï¼Œç”šè‡³æ˜¯å¯¹ä¸€ä¸ªæŒ‡é’ˆè§£å¼•ç”¨çš„ç»“æœéƒ½æ˜¯å±äºå¯å¯»å€çš„ã€‚é€šè¿‡è¿™å‡ ä¸ªä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ªå¯å¯»å€çš„reflect.Valueéƒ½æ˜¯éœ€è¦é€šè¿‡ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æŸå—å†…å­˜çš„åœ°å€æ¥é—´æ¥è·å–åˆ°çš„ã€‚æ¯”å¦‚è¯´ï¼Œs := string[]{&ldquo;1&rdquo;, &ldquo;2&rdquo;}, reflect.ValueOf(s)æ˜¯ä¸å¯å¯»å€çš„ï¼Œå®ƒåªæ˜¯é€šè¿‡è¿™ä¸ªsliceåº•å±‚å¼•ç”¨æ•°ç»„çš„èµ·å§‹åœ°å€æ„é€ äº†ä¸€ä¸ªreflect.Valueå€¼ã€‚ä½†æ˜¯è¿™æ—¶æˆ‘é€šè¿‡è°ƒç”¨reflect.ValueOf(s).Index(0)ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¯å¯»å€çš„å€¼ã€‚å› ä¸ºé€šé€šè¿‡reflect.ValueOfå¾—åˆ°äº†sliceå¼•ç”¨çš„åº•å±‚æ•°ç»„çš„èµ·å§‹åœ°å€ï¼Œç„¶åé€šè¿‡indexæ–¹æ³•è®¡ç®—äº†å†…å­˜çš„åç§»é‡ï¼Œå°±å¾—åˆ°äº†åœ¨è¿™æ®µè¿ç»­å†…å­˜å½“ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„å†…å­˜ç©ºé—´ï¼Œå³ä¸€ä¸ªå¯å¯»å€çš„å€¼ã€‚æ‰€ä»¥è¯´ï¼Œåœ¨reflectå½“ä¸­ï¼Œæƒ³è¦æ‹¿åˆ°ä¸€ä¸ªå¯å¯»å€å€¼ï¼Œé¦–å…ˆè¦å¾—åˆ°è¿™ä¸ªå¯å¯»å€å€¼æ‰€åœ¨çš„å†…å­˜ç©ºé—´çš„åœ°å€ã€‚</p>

<h2 id="æ›´æ–°å˜é‡">æ›´æ–°å˜é‡</h2>

<p>å½“æˆ‘ä»¬æƒ³è¦æ›´æ–°ä¸€ä¸ªreflect.Valueæ‰€å¼•ç”¨çš„å˜é‡çš„å€¼æ—¶ï¼Œå¯ä»¥é€šè¿‡Setæ–¹æ³•æ¥åšåˆ°ã€‚</p>

<pre><code>    x := []int{1,2}
    z := reflect.ValueOf(x).Index(0) //get an addressable reflectValue
    z.Set(reflect.ValueOf(3)) // update value
</code></pre>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è°ƒç”¨Setæ–¹æ³•è¿›è¡Œèµ‹å€¼æ“ä½œçš„æ—¶å€™ï¼ŒreflectåŒ…ä¼šåƒæ™®é€šæ•°æ®ç±»å‹çš„èµ‹å€¼æ“ä½œä¸€æ ·ï¼Œæ£€æŸ¥èµ‹å€¼çš„åˆæ³•æ€§ã€‚æ¯”å¦‚zæ ‡è¯†çš„å¯å¯»å€å€¼æ˜¯ä¸€ä¸ªintç±»å‹çš„ï¼Œå¦‚æœæ­¤æ—¶åœ¨è°ƒç”¨setæ–¹æ³•çš„æ—¶å€™ï¼Œèµ‹å€¼ç»™å…¶ä¸€ä¸ªint64ç±»å‹çš„å€¼å°±ä¼šå¯¼è‡´panicã€‚æ‰€ä»¥åœ¨ä½¿ç”¨setä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯æˆ‘ä»¬å°†è¦ç»™æŸä¸ªå˜é‡èµ‹çš„å€¼æ˜¯å®ƒèƒ½å¤Ÿæ¥å—çš„ã€‚ä½†æ˜¯Setæ–¹æ³•æœ‰ä¸€äº›å˜ä½“ï¼Œå¦‚SetInt, SetUintç­‰.åªè¦è°ƒç”¨è¿™äº›å‡½æ•°çš„å€¼æ˜¯æœ‰ç¬¦å·æ•´æ•°ç±»å‹ç”šè‡³æ˜¯å…¶åº•å±‚çš„æ•°æ®ç±»å‹ç¬¦åˆä»¥ä¸Šçš„æ¡ä»¶ï¼ŒsetIntç­‰æ–¹æ³•æ— è®ºæ¥æ”¶å¤šå¤§çš„æ•°å€¼éƒ½ä¼šé€šè¿‡æˆªæ–­çš„æ–¹å¼ï¼Œæ„é€ å‡ºä¸€ä¸ªè°ƒç”¨è¿™ä¸ªå‡½æ•°çš„å€¼èƒ½æ¥å—çš„ç»“æœå¹¶èµ‹å€¼ç»™å®ƒã€‚</p>

<p>åœ¨ç¬¬äºŒç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å®ç°çš„æ ¼å¼åŒ–è¾“å‡ºä»»æ„æ•°æ®ç±»å‹å€¼çš„ç¨‹åºä¸­ï¼Œå¦‚æœä½ ä»”ç»†è°ƒè¯•å°±ä¼šå‘ç°ï¼Œå¦‚æœè¾“å‡ºçš„æ˜¯ä¸€ä¸ªstructç±»å‹çš„å˜é‡ï¼Œé‚£ä¹ˆå…¶å†…éƒ¨ä¸å¯å¯¼å‡ºçš„fieldä¹Ÿå¯ä»¥è¢«æ‰¾åˆ°å¹¶ä¸”è¾“å‡ºã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡Fieldæˆ–è€…FieldByNameæ–¹æ³•æ¥è·å–structç±»å‹å€¼å½“ä¸­çš„æŸä¸€ä¸ªfieldï¼Œå¦‚æœè·å–çš„æ˜¯ä¸€ä¸ªä¸å¯å¯¼å‡ºçš„fieldï¼Œé‚£ä¹ˆå¯¹è¿™ä¸ªç»“æœè°ƒç”¨setç±»çš„ä¿®æ”¹æ–¹æ³•ä¼šå¯¼è‡´panicã€‚è¿™æ˜¯ä¸€ä¸ªç‰¹ä¾‹ï¼Œstructç»“æ„ä½“å†…çš„ä¸å¯å¯¼å‡ºfieldæ˜¯å¯å¯»å€çš„ï¼Œä½†æ˜¯æ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚</p>

<h1 id="æœ¬æ–‡ä»£ç ">æœ¬æ–‡ä»£ç </h1>

<p><a href="https://github.com/fengzixu/golangLearning/blob/master/reflect/encode.go">ç‚¹è¿™é‡Œ</a></p>
</main>

    <footer>
      
<script>
(function() {
  function center_el(tagName) {
    var tags = document.getElementsByTagName(tagName), i, tag;
    for (i = 0; i < tags.length; i++) {
      tag = tags[i];
      var parent = tag.parentElement;
      
      if (parent.childNodes.length === 1) {
        
        if (parent.nodeName === 'A') {
          parent = parent.parentElement;
          if (parent.childNodes.length != 1) continue;
        }
        if (parent.nodeName === 'P') parent.style.textAlign = 'center';
      }
    }
  }
  var tagNames = ['img', 'embed', 'object'];
  for (var i = 0; i < tagNames.length; i++) {
    center_el(tagNames[i]);
  }
})();
</script>

      
      <hr/>
      Open-Source | <a href="https://github.com/goodroot/hugo-classic">Github</a> | <a href="https://twitter.com/thegoodroot">Twitter</a>
      
    </footer>
  </body>
</html>

