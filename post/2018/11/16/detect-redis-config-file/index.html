<!DOCTYPE html>
<html lang="en-us" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Detect Redis Config File - LittleDriver</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="xuran" />
  <meta name="description" content="Include Part Include include 可以允许用户在 Redis 的 Conf 文件中引用一份「已经准备好」的配置。一般来说，我们都会把一些通用的且很少变化的配置放在一个「配置模板」中，然后在" />







<meta name="generator" content="Hugo 0.51" />


<link rel="canonical" href="http://littledriver.net/post/2018/11/16/detect-redis-config-file/" />



<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.f384a7fa4673433bc34e238c5074bb1303d90e5d5a29a2ffbaf61226ef213c29.css" integrity="sha256-84Sn&#43;kZzQzvDTiOMUHS7EwPZDl1aKaL/uvYSJu8hPCk=" media="screen">





<meta property="og:title" content="Detect Redis Config File" />
<meta property="og:description" content="Include Part Include include 可以允许用户在 Redis 的 Conf 文件中引用一份「已经准备好」的配置。一般来说，我们都会把一些通用的且很少变化的配置放在一个「配置模板」中，然后在" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://littledriver.net/post/2018/11/16/detect-redis-config-file/" /><meta property="article:published_time" content="2018-11-16T15:41:12&#43;08:00"/>
<meta property="article:modified_time" content="2018-11-16T15:41:12&#43;08:00"/>

<meta itemprop="name" content="Detect Redis Config File">
<meta itemprop="description" content="Include Part Include include 可以允许用户在 Redis 的 Conf 文件中引用一份「已经准备好」的配置。一般来说，我们都会把一些通用的且很少变化的配置放在一个「配置模板」中，然后在">


<meta itemprop="datePublished" content="2018-11-16T15:41:12&#43;08:00" />
<meta itemprop="dateModified" content="2018-11-16T15:41:12&#43;08:00" />
<meta itemprop="wordCount" content="6396">



<meta itemprop="keywords" content="Redis," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Detect Redis Config File"/>
<meta name="twitter:description" content="Include Part Include include 可以允许用户在 Redis 的 Conf 文件中引用一份「已经准备好」的配置。一般来说，我们都会把一些通用的且很少变化的配置放在一个「配置模板」中，然后在"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">LittleDriver</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://littledriver.net/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://littledriver.net/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://littledriver.net/tags/">Tags</a>
          
        
      </li>
    
  </ul>
</nav>


  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      LittleDriver
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://littledriver.net/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://littledriver.net/categories/">Categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://littledriver.net/tags/">Tags</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Detect Redis Config File</h1>
      
      <div class="post-meta">
        <time datetime="2018-11-16" class="post-time">
          2018-11-16
        </time>
        <div class="post-category">
            <a href="http://littledriver.net/categories/%E5%B7%A5%E4%BD%9C%E4%BA%86%E4%B9%9F%E4%B8%8D%E8%83%BD%E6%94%BE%E6%9D%BE%E7%B3%BB%E5%88%97/"> 工作了也不能放松系列 </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    

    
    <div class="post-content">
      

<h3 id="include-part">Include Part</h3>

<h4 id="include">Include</h4>

<p><code>include</code> 可以允许用户在 Redis 的 Conf 文件中引用一份「已经准备好」的配置。一般来说，我们都会把一些通用的且很少变化的配置放在一个「配置模板」中，然后在真正的 Redis-Server 启动的配置文件中使用<code>include</code> 命令包含它。这样一来，Redis-Server 在启动的时候就会使用配置模板内的配置项。</p>

<p>你也可以在<code>include</code> 命令后按照正常的方法写入其他配置。若新添加的配置项不在「配置模板」内容之中，那么这就相当于做了一个「追加」操作，否则，那将是一个「覆盖」操作。更为重要的是，<code>include</code> 的内容不会被<code>CONFIG REWRITE</code>命令的执行结果覆盖。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span><span class="c"># include /path/to/local.conf</span><span class="w">
</span><span class="w"></span><span class="c"># include /path/to/other.conf</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="load-part">Load Part</h3>

<h4 id="loadmodule">loadmodule</h4>

<p><code>loadmodule</code> 可以允许用户在 Redis 的 Conf 文件中指定在 Redis-Server 启动时要加载的「外部模块」。因为 Redis 本身也是通过 C 语言进行实现的，所以它在<code>redismodule.h</code>文件中提供了一些 C API， 可供用户在使用 C 语言实现「外部模块」的时候使用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span><span class="c"># loadmodule /path/to/my_module.so</span><span class="w">
</span><span class="w"></span><span class="c"># loadmodule /path/to/other_module.so</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="network-part">Network Part</h3>

<h4 id="bind">bind</h4>

<p><code>bind</code>配置项，允许用户指定一个或多个特定网卡的地址，并且将 Redis-Server 绑定在这个地址上。设置好了之后，若想通过 Redis-Cli 等工具访问 Redis-Server 的时候，<code>host</code> 参数必须指定<code>bind</code> 所绑定的地址。否则无法访问 Redis-Server。</p>

<p>默认情况下，Redis 将此配置项的缺省值指定为：<code>127.0.0.1</code>。这代表仅有和 Redis-Server 处于同一机器上的客户端可以访问。如果不指定<code>bind</code>配置项，那么 Redis-Server 将接受来自机器上所有网卡的链接。</p>

<p>这里一定需要注意的是，<code>bind</code> 参数是给 Redis-Server 绑定一个本地机器网卡的地址，而不是一个外部访问的 IP 地址。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span><span class="c"># bind 192.168.1.100 10.0.0.1</span><span class="w">
</span><span class="w"></span><span class="c"># bind 127.0.0.1 ::1</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="protected-mode">protected-mode</h4>

<p><code>protected-mode</code>是 Redis 除了访问密码之外为增加其安全性所给出的一个配置参数。该配置项默认开启，仅接受和 Redis-Server 处于同一机器上的客户端的链接。并且可以支持无密码访问。否则，会禁用掉这项保护措施。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span>protected-mode<span class="w"> </span>yes</code></pre></td></tr></table>
</div>
</div>
<h4 id="port">port</h4>

<p><code>port</code> 配置允许用户指定 Redis-Server 运行所监听的端口，默认情况下为 6379。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span>port<span class="w"> </span><span class="m">6379</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="tcp-backlog">tcp-backlog</h4>

<p><code>tcp-backlog</code>配置项是和 TCP 建立链接的过程有关的。对于使用者来说，可以简单的理解为，在完成了 TCP 的三次握手之后，客户端和 Redis—Server 建立链接的请求被放入了一个 Accept Queue 中，相当于进程的就绪队列，等待被 Redis-Server 处理。这个队列容量的大小就是受<code>tcp-backlog</code>配置项控制的。</p>

<p>理论上来说，如果使用 Redis 的服务有「高吞吐量」的特性，那么就需要在配置项中调大这个值。但是，这个值同时受到操作系统的相关参数的限制。最终 backlog 的值将取 <code>tcp-backlog</code> 和  /proc/sys/net/core/somaxconn 两个值中较小的那一个。默认情况下，这个值的参数为 511。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span>tcp-backlog<span class="w"> </span><span class="m">511</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="tcp-keepalive">tcp-keepalive</h4>

<p><code>tcp-keepalive</code> 是和 TCP 链接保活机制有关的一个参数。若该配置项的值大于0，则 Redis-Server 将每隔 <code>tcp-keepalive</code>秒向客户端发送一个保活探测报文，根据回应判断客户端当前是否正常。如果超过一定次数，发现对方仍然没有回应，则 Redis-Server 会主动断开他们之间的链接。若该配置项被设置为0，则 Redis—Server 不会再进行这个检测。否则将每隔 <code>tcp-keepalive</code>秒发送一次保活探测报文。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span>tcp-keepalive<span class="w"> </span><span class="m">500</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="unixsocket-unixsocketperm">unixsocket &amp;&amp; unixsocketperm</h4>

<p><code>unixsocket</code> 和 <code>unixsocketperm</code> 是 Unix socket 的配置项。如果用户想通过 Unix socket 的方式来链接 Redis-Server 的话，需要开启这两个配置，使得 Redis-Server 可以监听从 Unix socket 进来的链接。默认情况下这两个配置是不开启的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span><span class="c"># unixsocket /tmp/redis.sock</span><span class="w">
</span><span class="w"></span><span class="c"># unixsocketperm 700</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="timeout">timeout</h4>

<p><code>timeout</code> 配置项可以让用户自由指定一个客户端到 Redis-Server 的链接在空闲多久之后断开，单位是秒。当配置为 0 的时候，意味着链接永远不会断开，直到通信双方有一方进程停掉。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span>timeout<span class="w"> </span><span class="m">0</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="general-part">General Part</h3>

<h4 id="daemonize">daemonize</h4>

<p><code>daemonize</code>配置项可以由用户来决定，是否以「守护进程」的方式来运行 Redis-Server。默认情况下这个配置项是禁用的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span>daemonize<span class="w"> </span>no</code></pre></td></tr></table>
</div>
</div>
<h4 id="pidfile">pidfile</h4>

<p><code>pidfile</code> 配置项允许用户指定一个文件的绝对路径。该文件的内容为 Redis-Server 进程的 PID。若已经开启了 <code>daemonize</code>配置且<code>pidfile</code>指定了一个路径，那么默认情况下会将  Redis-Server 的 PID 写入到<code>pidfile</code>指定的文件中。否则，写入到<code>/var/run/redis.pid</code>中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span>pidfile<span class="w"> </span>/var/run/redis_6379.pid</code></pre></td></tr></table>
</div>
</div>
<h4 id="loglevel-logfile">loglevel &amp;&amp; logfile</h4>

<p><code>loglevel</code> 配置项允许用户指定 Redis-Server 日志输出的等级。等级越高，输出的信息也就越丰富。该配置项的候选值有如下几个：</p>

<ul>
<li>warning： 仅一些必要的错误信息和重要的信息</li>
<li>notice: 除一些必要的错误信息和重要的信息之外，有一部分的冗余信息。推荐在生产环境中开启</li>
<li>verbose：信息更加丰富，揭示 Redis-Server 的运行过程</li>
<li>debug：Redis-Server 能够输出的所有的信息</li>
</ul>

<p><code>logfile</code>允许用户指定 Redis-Server 服务日志的存放路径。默认情况下如果不指定这个参数，Redis—Server 会将日志输出到标准输入。而且，如果是以守护进程的模式运行的话，日志会被打入「黑洞」：<code>/dev/null</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span>loglevel<span class="w"> </span>notice<span class="w">
</span><span class="w"></span>logfile<span class="w"> </span><span class="s2">&#34;/var/redis/log&#34;</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="syslog-enabled-syslog-ident">syslog-enabled &amp;&amp; syslog-ident</h4>

<p><code>syslog-enabled</code> 配置项开启之后，会将 Redis-Server 的服务日志输出到操作系统日志所在的文件中。也就是<code>/var/log/syslog</code>。默认情况下这个配置是关闭的。</p>

<p><code>syslog-ident</code> 配置项主要是用来给输出到系统日志的 Redis-Server 的服务日志内容添加一些特殊的标记，方便通过一些工具进行筛选。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span>syslog-enabled<span class="w"> </span>yes<span class="w">
</span><span class="w"></span>syslog-ident<span class="w"> </span>native-redis</code></pre></td></tr></table>
</div>
</div>
<h4 id="databases">databases</h4>

<p>在一个 Redis 的实例中，通常会将它申请的内存按照 <code>databases</code>配置项的值切分成不同的部分 (即「分组」操作)。每一个子 database 通过整数进行索引，编号从 0~ databases。在对 Redis 操作之前，可以先通过 select 命令选取其中一个子数据库进行读取和写入。若你在两个不同的子数据库中写入相同的 key 但是不同的值之后就会发现，两者是不发生冲突的。默认情况下 <code>databases</code>配置项为16。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span>databases<span class="w"> </span><span class="m">16</span></code></pre></td></tr></table>
</div>
</div>
<p>Redis 之所以提供了这样的功能，最主要的原因是，很多重要的功能无法在多个 Redis 实例上一起配合来实现。如涉及到多个实例上的 Key 的事务功能是不可以用的。Redis 提供的分区功能，是在同一个进程的内存空间中实现了内存使用的隔离。至于每一个 db 被分配多少内存，一个 db 写满了之后会发生什么，是和 Redis 的内存分配策略有关的，这里暂时不详细介绍了。</p>

<h3 id="rdb-backup">RDB Backup</h3>

<h4 id="save">save</h4>

<p>RDB 是 Redis 提供的一种「快照」形式的备份策略。它不能够保证高实时性，但是可以对 Redis 数据的「容灾性」提供一个比较好的帮助。</p>

<p>用户可以通过 <code>save</code>配置来设定 RDB 备份的策略，如 <code>save 900 1</code>，意味着当900秒的时间内，如果有1个 key 的内容发生了改变，那么在900秒的时间结束后，就会进行一次 RDB 的备份操作。当然，如果你想禁用掉这个 RDB 的备份功能，可以在配置文件中不指定 <code>save</code>配置项。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span>save<span class="w"> </span><span class="m">900</span><span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c"># 900s 内至少有一个 Key 的内容发生修改就备份</span><span class="w">
</span><span class="w"></span>save<span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="c"># 1000s 内至少有两个 Key 的内容发生修改就备份</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="stop-writes-on-bgsave-error">stop-writes-on-bgsave-error</h4>

<p>默认开启 RDB 备份功能的情况下，备份操作可能会出现失败的情况。此时，如果用户和运维都没有察觉的话，最终的结果可能是灾难性的。<code>stop-writes-on-bgsave-error</code>配置项允许用户借助 Redis 自身提供的一个功能：RDB 备份失败后，写入操作会报错。直到下一次 RDB 备份开始，才允许客户端进行写入。</p>

<p>不过，Redis 自身提供的这个「防范机制」有点太暴力的。如果想自己去感知这个问题并且做出一些处理，可以对 Redis 的一些指标进行监控，然后将这个配置关掉。因为它默认是开启的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml">stop-writes-on-bgsave-error<span class="w"> </span>yes</code></pre></td></tr></table>
</div>
</div>
<h4 id="rdbcompression">rdbcompression</h4>

<p><code>rdbcompression</code> 配置项开启之后，Redis 在进行 RDB 备份的时候，会对 String 类型的内容按照一定的压缩算法进行压缩，以节省空间。此配置项默认开启。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Exapmle </span><span class="w">
</span><span class="w"></span>rdbcompression<span class="w"> </span>yes</code></pre></td></tr></table>
</div>
</div>
<h4 id="rdbchecksum">rdbchecksum</h4>

<p>默认情况下，RDB 备份操作之后，会在备份文件的末尾插入一些校验位，以保证数据的完整性。若<code>rdbchecksum</code> 配置项开启，则在 Redis 导入备份数据的时候，会消耗一定的性能对备份数据进行校验，防止导入脏数据甚至是导入数据失败。此配置项默认开启。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Exapmle </span><span class="w">
</span><span class="w"></span>rdbchecksum<span class="w"> </span>yes</code></pre></td></tr></table>
</div>
</div>
<h4 id="dbfilename">dbfilename</h4>

<p><code>dbfilename</code>可以指定 Redis 创建的 RDB 备份文件的名称。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span>dbfilename<span class="w"> </span>dump.rdb</code></pre></td></tr></table>
</div>
</div>
<h3 id="dir">Dir</h3>

<p><code>dir</code> 配置项可以由用户指定 RDB 备份文件的存放路径。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example </span><span class="w">
</span><span class="w"></span>dir<span class="w"> </span>./</code></pre></td></tr></table>
</div>
</div>
<h3 id="aof-backup">AOF Backup</h3>

<h4 id="appendonly">appendonly</h4>

<p>AOF 是 Redis 为了保证数据可靠性提供的第二种数据持久化方案。它记录的是 Redis 的写入操作而非数据。AOF 的实时性更强，因为 RDB 快照的属性，总是有相当大的风险丢失两次 RDB 备份之间的数据的。<code>appendonly</code>配置项可以开启和关闭 AOF 的功能。该配置项默认开启。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example </span><span class="w">
</span><span class="w"></span>appendonly<span class="w"> </span>yes</code></pre></td></tr></table>
</div>
</div>
<h4 id="appendfilename">appendfilename</h4>

<p><code>appendfilename</code>可以指定 Redis 创建的 aof 备份文件的名称。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example </span><span class="w">
</span><span class="w"></span>appendfilename<span class="w"> </span>a.aof</code></pre></td></tr></table>
</div>
</div>
<h4 id="appendfsync">appendfsync</h4>

<p>Redis 在开启了 AOF 之后会将操作记录写在内存当中。但是这仍然是不安全的，因为进程 down 掉或者机器掉电，这些数据都没了。而操作系统自动将内存数据 flush 到硬盘的频率是比较长的，不一定能够满足用户对于 AOF 实时性的需求。所以提供了一个名为 <code>appendfsync</code> 的配置来调整 flush 写入记录到硬盘的频率。默认情况下是每秒保存一次。</p>

<ul>
<li>appendfsync always： 每一个操作都会 flush 到硬盘</li>
<li>appendfsync everysec：每秒做一次 flush 操作</li>
<li>appendfsync no：不主动做 flush，依靠操作系统的机制</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example </span><span class="w">
</span><span class="w"></span>appendfsync<span class="w"> </span>everysec</code></pre></td></tr></table>
</div>
</div>
<h4 id="no-appendfsync-on-rewrite">no-appendfsync-on-rewrite</h4>

<p>AOF 文件重写，RDB 快照备份，都是需要进行磁盘I/O 的操作。如果再加上 AOF 以每秒或者每个操作的写入，势必会发生一些 I/O 阻塞的问题。Redis 在这个问题上，采取了「规避」的方式来处理。当 <code>no-appendfsync-on-rewrite</code>配置项开启之后，如果统一时间段里有其他的磁盘操作在进行，AOF 的 flush 操作可能会延迟一会执行。当然，提升性能的同时带来的问题就是用户需要忍受 AOF 的实时性会有降低。该配置默认关闭。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example </span><span class="w">
</span><span class="w"></span>no-appendfsync-on-rewrite<span class="w"> </span>no</code></pre></td></tr></table>
</div>
</div>
<h4 id="auto-aof-rewrite-percentage-auto-aof-rewrite-min-size">auto-aof-rewrite-percentage &amp;&amp; auto-aof-rewrite-min-size</h4>

<p>AOF 文件随着对 Redis 操作的增多，其文件大小也会上升。但是 Redis 中有很多写操作是可以进行合并的，比如你对一个 Key，先 set 一个 A，又 set 了一个 B。最终 B 是有效的，此时就可以把两个 Set 操作合二为一。Redis 使用 <code>auto-aof-rewrite-percentage</code> 和 <code>auto-aof-rewrite-min-size</code> 两个配置为重写操作提供了一些定制化的功能：</p>

<ul>
<li>auto-aof-rewrite-percentage： 在第一次  AOF 文件重写之后，会记录一个 base size，Redis 会定义将目前 AOF 文件的大小和这个 base size 比较。如果current size 已经达到了base size 的某个比例的大小，就会进行重写操作。base size 在每一次 Rewrite 操作之后都会更新。该配置项取值 0~100.</li>
<li>auto-aof-rewrite-min-size：为了防止 AOF 文件在重写的过程中变的越来越小，可以指定一个该文件最小的大小。如果 current size 还没有达到它所设置的阈值，则不会发生AOF 文件重写。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example </span><span class="w">
</span><span class="w"></span>auto-aof-rewrite-percentage<span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="w"></span>auto-aof-rewrite-min-size<span class="w"> </span>64mb</code></pre></td></tr></table>
</div>
</div>
<h4 id="aof-load-truncated">aof-load-truncated</h4>

<p>Redis 在重新启动的时候，会通过加载 AOF 和 RDB 文件两种方式来恢复内存中的数据。其中 AOF 文件会优先使用。如果在 Load AOF 文件中所写入的数据时候，发现在 AOF 文件的尾部有内容上的损坏，则用户可以通过指定 <code>aof-load-truncated</code>配置项来指示 Redis 到底是应该继续恢复并且尽可能多的恢复数据，还是立刻报错。默认情况下，Redis 会尽可能多的读入数据，<code>aof-load-truncated</code>的值为 Yes。</p>

<p>但是，这里要注意的是，被损坏的部分仅限于 AOF 文件的尾端。若中间部分有损坏，Redis 会无视这个配置项，直接报错。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example </span><span class="w">
</span><span class="w"></span>aof-load-truncated<span class="w"> </span>yes</code></pre></td></tr></table>
</div>
</div>
<h3 id="replica">Replica</h3>

<h4 id="masterauth">masterauth</h4>

<p>如果 Master 已经配置了访问密码，那么需要在从节点的配置中加入<code>masterauth</code>配置项，并将访问密码作为该配置项的值。因为在从节点要和主节点建立数据同步链接的时候，需要通过访问密码来鉴权。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml">masterauth<span class="w"> </span>rootroot</code></pre></td></tr></table>
</div>
</div>
<h4 id="replica-serve-stale-data">replica-serve-stale-data</h4>

<p><code>replica-serve-stale-data</code>配置项允许用户设定，当主从链接断开的时候，从节点如何响应客户端的请求。默认情况下，该配置项的值为 yes， 即允许从节点正常响应用户的请求，但是可能会发生数据是过期的，甚至是根本没有数据的情况。若将其赋值为 no，则从节点将会对客户端的请求返回一个错误，拒绝提供服务。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example </span><span class="w">
</span><span class="w"></span>replica-serve-stale-data<span class="w"> </span>yes</code></pre></td></tr></table>
</div>
</div>
<h4 id="replica-read-only">replica-read-only</h4>

<p><code>replica-read-only</code> 配置项允许用户将从节点设置为只读模式。这是一种保护措施。因为当主从关系建立之后，主节点会一直向从节点同步数据。如果用户向从节点写数据的话，最终会被覆盖。该配置项默认为yes。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example </span><span class="w">
</span><span class="w"></span>replica-read-only<span class="w"> </span>yes</code></pre></td></tr></table>
</div>
</div>
<h4 id="repl-ping-replica-period">repl-ping-replica-period</h4>

<p>该配置项默认值为10，表示从节点每隔 10s 将向主节点执行 PING 命令，以确认两者之间的关系正常。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example </span><span class="w">
</span><span class="w"></span>repl-ping-replica-period<span class="w"> </span>yes</code></pre></td></tr></table>
</div>
</div>
<h4 id="repl-timeout">repl-timeout</h4>

<p><code>repl-timeout</code>配置项为主从节点之间设置了一个通信的超时时间。若该配置项指定的时间内发现两者没有通信，则认为主从节点间的链接异常。这个配置项的值在设置的时候需要大于 <code>replica-read-only</code>配置项的值，否则在主从节点之间数据量较低的情况下，可能会一直检测到「超时」。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example </span><span class="w">
</span><span class="w"></span>repl-timeout<span class="w"> </span>yes</code></pre></td></tr></table>
</div>
</div>
<h4 id="repl-disable-tcp-nodelay">repl-disable-tcp-nodelay</h4>

<p><code>repl-disable-tcp-nodelay</code>配置项主要用于控制主从节点同步数据的速率。若该配置项的值为 yes，则 Redis 将使用更小尺寸的 TCP 报文和更小的带宽来进行数据同步操作。好处比较明显，能够控制 Redis 数据同步的流量，坏处就是增加了数据同步的时延。反之，如果设置为 no，则会去掉这个限制。提升数据同步的效率。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example </span><span class="w">
</span><span class="w"></span>repl-disable-tcp-nodelay<span class="w"> </span>yes</code></pre></td></tr></table>
</div>
</div>
<h4 id="repl-backlog-size-repl-backlog-ttl">repl-backlog-size &amp;&amp; repl-backlog-ttl</h4>

<p>Master 节点会为 Slave 节点配置一个复制缓冲区，用来保存最新的需要同步的数据。当 Slave 节点和 Master 节点断开连接之后又重新建立链接的时候，很可能只需要一次「局部」的同步操作即可实现主从数据的一致性。这就是复制缓冲区的作用。而 <code>repl-backlog-size</code> 配置项，指定了这个缓冲区的大小。缓冲区越大，那么保存的数据也就越多，对 Slave 节点离线时间的长度容忍度也就越高。</p>

<p>但是，如果主从链接是我们有意断开的，这个复制缓冲区总不能一直保存在那里。所以 Redis 提供了<code>repl-backlog-ttl</code>配置项，当主从链接断开的时间超过该配置项的值的时候，Master 节点将会清空这个复制缓冲区的内容。</p>

<p><code>repl-backlog-size</code> 默认值为 16mb，<code>repl-backlog-ttl</code> 为3600。</p>

<h4 id="replica-priority">replica-priority</h4>

<p><code>replica-priority</code> 配置项主要用于 Redis Slave 节点，标识了这个节点的优先级，取值范围从0~100。数字越低，优先级越高。在进行主从切换的时候越有可能被 Sentinel 节点提升为 Master 节点。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example </span><span class="w">
</span><span class="w"></span>replica-priority<span class="w"> </span><span class="m">100</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="min-replicas-to-write-min-replicas-max-lag">min-replicas-to-write &amp;&amp; min-replicas-max-lag</h4>

<p><code>min-replicas-to-write</code> 和 <code>min-replicas-max-lag</code> 两个配置项分别指定了最小链接到主节点的活跃的从节点的个数以及最大主从节点通信的延迟。如果在主从节点通信的过程中，这个两个选项的条件有哪一个没有满足，主节点将拒绝客户端的写入操作。前者默认值为3，或者为10，都是秒为单位。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span><span class="c">#</span><span class="w">
</span><span class="w"></span><span class="c"># min-replicas-to-write 3</span><span class="w">
</span><span class="w"></span><span class="c"># min-replicas-max-lag 10</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="slave-announce-ip-slave-announce-port">slave-announce-ip &amp;&amp; slave-announce-port</h4>

<p>一般来说，通过对 Master 节点执行 Info Replication 命令，即可通过 Master 节点列出所有的 Slave 节点的相关信息（IP，port 等）。Master 节点本来是可以通过两者之间的链接来发现 Slave 节点的 IP 和端口的。但是，如果在环境中启动了 NAT 或者端口转发机制（尤其是在 Docker 和 k8s 中），或者说，两者通信链路之间还通过了一些「代理」，在 Master 上显示的 Slave 节点的信息可能就不准确。所以，用户可以通过 <code>slave-announce-ip</code>和 <code>slave-announce-port</code> 配置项，强制指定 Slave 节点的 IP 和 Port，并将此信息通知给 Master 节点。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span><span class="c"># replica-announce-ip 5.5.5.5</span><span class="w">
</span><span class="w"></span><span class="c"># replica-announce-port 1234</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="security">Security</h3>

<h4 id="requirepass">requirepass</h4>

<p>用户可以通过<code>requirepass</code>配置项为 Redis Server 设置密码。客户端在连接了服务端之后，需要使用密码鉴权才能够执行命令。</p>

<h4 id="rename-command">rename-command</h4>

<p><code>rename-command</code> 是 Redis 为提升其安全性加入的配置项。它允许用户将一些高危命令进行重命名，以防止用户不小心或者恶意对数据库做出一些危险的操作。</p>

<p>这个配置项虽然有用，可以提升安全性。但是最好用在 Redis 实例只有一个用户使用的场景下。因为不同的用户需求不同，强行禁用掉一些命令也并不是一个好事。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span><span class="c"># rename-command CONFIG &#34;&#34;</span><span class="w">
</span><span class="w"></span><span class="c"># rename-command flushall &#34;&#34;</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="memory">Memory</h3>

<p>内存对于 Redis 是一个非常重要的资源，它是 Redis 高性能的支撑点，同时也是最容易出问题的地方。所以，Redis 也开放了一些配置项，使得用户可以根据自己不同的使用姿势来对 Redis 使用内存的行为作出一些限制，以此来提高效率和防止一些问题的发生。</p>

<h4 id="maxmemory-maxmemory-policy">maxmemory &amp;&amp; maxmemory-policy</h4>

<p>该配置项允许用户为 Redis 配置一个「最大内存使用值」。如果用户在设置了<code>maxmemory</code>的同时还通过 <code>maxmemory-policy</code>设置了一定的缓存淘汰策略。那么当Redis 实例的内存使用量达到阈值之后，会通过「淘汰规则」清理掉一部分的数据，以留出足够的空间来正常响应后续的写入操作。否则，若没有设置淘汰策略(默认为noeviction)，当 Redis 实例的内存达到阈值之后，会拒绝写入操作，但是正常响应读取操作。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span><span class="c"># maxmemory &lt;bytes&gt;</span><span class="w">
</span><span class="w"></span><span class="c"># maxmemory-policy noeviction</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="maxmemory-samples">maxmemory-samples</h4>

<p>Redis 在执行内存淘汰策略的时候，会按照一定的规则选取「候选样本」。比如，当用户将<code>maxmemory-policy</code>设置为<code>volatile-lru</code>的时候，如果 Redis 实例的内存用量达到了<code>maxmemory</code>指定的阈值，Redis 就会每次取<code>maxmemory-samples</code>个 key 为样本，删掉一个最近未使用时间最长的 key。<code>maxmemory-samples</code>设置的值越大，淘汰策略越接近真实的 LRU 算法，但是同时给 CPU 造成的压力也会增加。否则，虽然会运行的比较快，但是淘汰的效果不会很好。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Example</span><span class="w">
</span><span class="w"></span><span class="c"># maxmemory-samples 5</span></code></pre></td></tr></table>
</div>
</div>
    </div>

    
    

    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://littledriver.net/tags/redis/">Redis</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/2018/11/17/head-first-cgroup/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Head First CGroup</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/2018/11/15/k8s-gc-design-principle/">
            <span class="next-text nav-default">K8s GC Design Principle</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    Show Disqus Comments
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "http://littledriver.net/post/2018/11/16/detect-redis-config-file/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'fengzixu';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>
  
    



        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
  
    <a href="mailto:hnustphoenix@email.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://twitter.com/Haier0715" rel="me noopener" class="iconfont"
      title="twitter"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1264 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M1229.8616 18.043658c0 0-117.852626 63.135335-164.151872 67.344358-105.225559-164.151872-505.082682-92.598492-437.738325 223.078185C278.622548 312.675223 89.216542 47.506814 89.216542 47.506814s-117.852626 189.406006 75.762402 345.139833C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042C1179.353331 249.539887 1263.533778 123.269217 1263.533778 123.269217s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"></path>
</svg>

    </a>
  
    <a href="https://github.com/fengzixu" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="http://littledriver.net/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
       -
    2018
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        xuran
        
      </span></span>

  
  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ="></script>














  <script id="dsq-count-scr" src="//fengzixu.disqus.com/count.js" async></script>





</body>
</html>
